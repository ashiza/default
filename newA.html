// File: src/components/StampMaker.jsx
/*
TL;DR
A single-file React component that implements a web-based stamp maker inspired by the provided sites.
Features: choose shape (circle/square/triangle), add circular & center text, upload SVG/logo, adjust fonts/sizes/spacing, live SVG preview, download SVG or PNG.

PLAN / PSEUDOCODE
1. UI layout: left controls, right preview + export.
2. Controls:
   - Shape selector (circle | square | triangle)
   - Outer ring toggle and circular text input + font-size + letter-spacing
   - Center text input + font, size
   - Upload logo (SVG/PNG) with basic positioning and scale
   - Color and stroke options (ink color, ring thickness)
   - Size slider (mm -> px conversion for preview)
3. Model state: shape, outerText, centerText, logo (dataURL), colors, sizes, ringRadius, scale, fonts.
4. SVG renderer: build an <svg> that composes shapes, ring, circular text (using <textPath>), center text, and logo image (embedded as <image> or <use> for svg).
5. Export functions:
   - exportSVG: serialize SVG node and download as .svg
   - exportPNG: serialize SVG to XML, create Image, draw into canvas at desired DPI, then download png
6. Utilities: mmToPx conversion, sanitize uploaded SVG, base64 helpers
7. Minimal accessibility and responsiveness.

USAGE
- Drop this file into a React app that uses Tailwind CSS (or adapt classes), import and mount <StampMaker/>.


import React, { useRef, useState, useEffect } from 'react';

export default function StampMaker() {
  const svgRef = useRef(null);
  const [shape, setShape] = useState('circle');
  const [sizeMm, setSizeMm] = useState(38);
  const [inkColor, setInkColor] = useState('#000000');
  const [ringThickness, setRingThickness] = useState(4);

  // Outer circular text
  const [outerText, setOuterText] = useState('COMPANY NAME');
  const [outerFontSize, setOuterFontSize] = useState(12);
  const [outerLetterSpacing, setOuterLetterSpacing] = useState(0);
  const [outerEnabled, setOuterEnabled] = useState(true);

  // Center text
  const [centerText, setCenterText] = useState('Logo');
  const [centerFontSize, setCenterFontSize] = useState(18);

  // Logo
  const [logoDataUrl, setLogoDataUrl] = useState(null);
  const [logoScale, setLogoScale] = useState(1);
  const [logoX, setLogoX] = useState(0);
  const [logoY, setLogoY] = useState(0);

  // Derived sizes
  const dpi = 300; // for high-res PNG export
  const mmToPx = (mm, ppi = 96) => Math.round((mm / 25.4) * ppi);
  const viewBoxPx = mmToPx(sizeMm, 300); // high-res preview internally

  // Simple set of fonts; for production load Google Fonts dynamically
  const fonts = ['Arial', 'Georgia', 'Times New Roman', 'Verdana', 'Courier New'];
  const [outerFont, setOuterFont] = useState(fonts[0]);
  const [centerFont, setCenterFont] = useState(fonts[0]);

  // Helpers
  function handleLogoUpload(e) {
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    const reader = new FileReader();
    reader.onload = () => setLogoDataUrl(reader.result);
    reader.readAsDataURL(f);
  }

  function download(filename, content, mime) {
    const blob = new Blob([content], { type: mime });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function exportSVG() {
    const svg = svgRef.current;
    if (!svg) return;
    const serializer = new XMLSerializer();
    const clone = svg.cloneNode(true);
    // inline styles that could be necessary
    clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
    const str = serializer.serializeToString(clone);
    download('stamp.svg', str, 'image/svg+xml;charset=utf-8');
  }

  async function exportPNG() {
    const svg = svgRef.current;
    if (!svg) return;
    const serializer = new XMLSerializer();
    const clone = svg.cloneNode(true);
    clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
    const str = serializer.serializeToString(clone);
    const svgBlob = new Blob([str], { type: 'image/svg+xml;charset=utf-8' });
    const url = URL.createObjectURL(svgBlob);

    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      // export at 300 DPI relative to mm size
      const px = Math.round((sizeMm / 25.4) * dpi);
      canvas.width = px;
      canvas.height = px;
      const ctx = canvas.getContext('2d');
      // white background optional — keep transparent by default
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // center image
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      canvas.toBlob((blob) => {
        const url2 = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url2;
        a.download = 'stamp.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url2);
        URL.revokeObjectURL(url);
      }, 'image/png');
    };
    img.onerror = (e) => {
      console.error('Failed to convert SVG to PNG', e);
      URL.revokeObjectURL(url);
    };
    img.src = url;
  }

  // Build path for circular text
  const idForPath = 'outerPath';
  const radius = Math.max( (viewBoxPx / 2) - 20, 10 );

  function renderShape() {
    const cx = viewBoxPx / 2;
    const cy = viewBoxPx / 2;
    if (shape === 'circle') {
      return (
        <circle cx={cx} cy={cy} r={radius} stroke={inkColor} strokeWidth={ringThickness} fill="none" />
      );
    }
    if (shape === 'square') {
      const pad = ringThickness;
      const size = radius * Math.SQRT2;
      return (
        <rect x={cx - size/2} y={cy - size/2} width={size} height={size} stroke={inkColor} strokeWidth={ringThickness} fill="none" rx={Math.max(4, ringThickness)} />
      );
    }
    if (shape === 'triangle') {
      const s = radius * Math.SQRT2;
      const p1 = `${cx},${cy - s/1.4}`;
      const p2 = `${cx - s/1.2},${cy + s/2.2}`;
      const p3 = `${cx + s/1.2},${cy + s/2.2}`;
      return (
        <polygon points={`${p1} ${p2} ${p3}`} stroke={inkColor} strokeWidth={ringThickness} fill="none" />
      );
    }
    return null;
  }

  // Compute transform for logo
  function logoProps() {
    if (!logoDataUrl) return { width: 0, height: 0 };
    const max = radius * 1.1 * logoScale;
    const cx = viewBoxPx / 2;
    const cy = viewBoxPx / 2;
    const w = max;
    const h = max;
    return { x: cx - w/2 + logoX, y: cy - h/2 + logoY, width: w, height: h };
  }

  return (
    <div className="flex gap-6 p-6">
      <div className="w-96 bg-white rounded shadow p-4">
        <h3 className="font-bold mb-2">Stamp Controls</h3>
        <div className="space-y-3 text-sm">
          <label className="block">Shape
            <select value={shape} onChange={(e) => setShape(e.target.value)} className="w-full mt-1 p-2 border rounded">
              <option value="circle">Circle</option>
              <option value="square">Square</option>
              <option value="triangle">Triangle</option>
            </select>
          </label>

          <label>Size (mm)
            <input type="range" min="10" max="120" value={sizeMm} onChange={(e)=>setSizeMm(Number(e.target.value))} />
            <div>{sizeMm} mm</div>
          </label>

          <label>Ink color
            <input type="color" value={inkColor} onChange={(e)=>setInkColor(e.target.value)} className="block mt-1" />
          </label>

          <label>Ring thickness
            <input type="range" min="1" max="20" value={ringThickness} onChange={(e)=>setRingThickness(Number(e.target.value))} />
            <div>{ringThickness}px</div>
          </label>

          <hr />

          <label className="flex items-center gap-2"> <input type="checkbox" checked={outerEnabled} onChange={(e)=>setOuterEnabled(e.target.checked)} /> Outer circular text</label>
          {outerEnabled && (
            <>
              <input className="w-full p-2 border rounded mt-1" value={outerText} onChange={(e)=>setOuterText(e.target.value)} placeholder="ENTER OUTER TEXT" />
              <div className="grid grid-cols-2 gap-2">
                <div>Font
                  <select value={outerFont} onChange={(e)=>setOuterFont(e.target.value)} className="w-full p-1 border rounded mt-1">
                    {fonts.map(f=> <option key={f} value={f}>{f}</option>)}
                  </select>
                </div>
                <div>Size
                  <input type="number" value={outerFontSize} onChange={(e)=>setOuterFontSize(Number(e.target.value))} className="w-full p-1 border rounded mt-1" />
                </div>
              </div>
              <label>Letter spacing
                <input type="range" min="-5" max="10" value={outerLetterSpacing} onChange={(e)=>setOuterLetterSpacing(Number(e.target.value))} />
              </label>
            </>
          )}

          <hr />

          <label>Center text
            <input className="w-full p-2 border rounded mt-1" value={centerText} onChange={(e)=>setCenterText(e.target.value)} />
            <div className="grid grid-cols-2 gap-2 mt-1">
              <select value={centerFont} onChange={(e)=>setCenterFont(e.target.value)} className="p-1 border rounded">
                {fonts.map(f=> <option key={f} value={f}>{f}</option>)}
              </select>
              <input type="number" value={centerFontSize} onChange={(e)=>setCenterFontSize(Number(e.target.value))} className="p-1 border rounded" />
            </div>
          </label>

          <hr />

          <label>Upload logo (SVG/PNG)
            <input type="file" accept="image/*,.svg" onChange={handleLogoUpload} className="block mt-1" />
          </label>
          {logoDataUrl && (
            <div className="space-y-1">
              <div>Scale
                <input type="range" min="0.2" max="2" step="0.05" value={logoScale} onChange={(e)=>setLogoScale(Number(e.target.value))} />
                <div>{logoScale.toFixed(2)}</div>
              </div>
              <div className="grid grid-cols-2 gap-2">
                <label>X <input type="range" min="-50" max="50" value={logoX} onChange={(e)=>setLogoX(Number(e.target.value))} /></label>
                <label>Y <input type="range" min="-50" max="50" value={logoY} onChange={(e)=>setLogoY(Number(e.target.value))} /></label>
              </div>
            </div>
          )}

          <div className="flex gap-2 mt-3">
            <button onClick={exportSVG} className="px-3 py-2 bg-slate-800 text-white rounded">Download SVG</button>
            <button onClick={exportPNG} className="px-3 py-2 bg-slate-700 text-white rounded">Download PNG</button>
          </div>
        </div>
      </div>

      <div className="flex-1 bg-white rounded shadow p-4 flex flex-col">
        <h3 className="font-bold mb-2">Live Preview</h3>
        <div className="flex-1 flex items-center justify-center">
          <div className="bg-gray-50 p-4 rounded">
            <svg ref={svgRef} width={400} height={400} viewBox={`0 0 ${viewBoxPx} ${viewBoxPx}`} xmlns="http://www.w3.org/2000/svg">
              <defs>
                <path id={idForPath} d={`M ${viewBoxPx/2} ${viewBoxPx/2 - radius} A ${radius} ${radius} 0 1 1 ${viewBoxPx/2 - 0.001} ${viewBoxPx/2 - radius}`} />
              </defs>

              {/* background guide */}
              <rect x="0" y="0" width={viewBoxPx} height={viewBoxPx} fill="transparent" />

              {renderShape()}

              {/* outer circular text */}
              {outerEnabled && (
                <text fontFamily={outerFont} fontSize={outerFontSize} fill={inkColor} letterSpacing={`${outerLetterSpacing}px`} textAnchor="middle">
                  <textPath startOffset="50%" href={`#${idForPath}`}>{outerText}</textPath>
                </text>
              )}

              {/* logo image */}
              {logoDataUrl && (()=>{
                const p = logoProps();
                return <image href={logoDataUrl} x={p.x} y={p.y} width={p.width} height={p.height} preserveAspectRatio="xMidYMid meet" />;
              })()}

              {/* center text */}
              <text x={viewBoxPx/2} y={viewBoxPx/2 + centerFontSize/3} fontFamily={centerFont} fontSize={centerFontSize} fill={inkColor} textAnchor="middle">{centerText}</text>
            </svg>
          </div>
        </div>

        <div className="mt-3 text-xs text-slate-600">Size: {sizeMm}mm — Preview drawn at 300 DPI for export fidelity.</div>
      </div>
    </div>
  );
}

/*
Minimal notes:
- For production, sanitize uploaded SVGs to avoid XSS and properly inline fonts (or load Google Fonts dynamically).
- Improve circular text by calculating spacing & flipping orientation for bottom half if needed.
- Add templates, pre-made icons, and server-side rendering for higher performance.
*/


**a.** Would you like me to add preset templates (e.g., Notary, Wedding, Corporate) to the UI?
**b.** Want unit tests or an automated export pipeline (zip with SVG+PNG+PDF)?
